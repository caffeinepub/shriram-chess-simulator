{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Chess game: implement pawn promotion from scratch (UI popup as in-board overlay) and add full chess rules validation.",
  "architectural_notes": [],
  "known_issues": [
    "Pawn promotion move is not working (needs rebuild from scratch)."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-implement-a-pawn-promotion-selection-flow-from-scratch-for-human-moves-when-a-pawn-move-reaches-the-last-rank-pause-move-execution-and-show-an-in-board-overlay-popup-that-lets-the-player-choose-the-promotion-piece-queen-rook-bishop-knight-then-apply-the-move-with-the-chosen-promotion",
      "title": "Implement a pawn-promotion selection flow from scratch for human moves: when a pawn move reaches the last rank, pause move execution and show an in-board overlay popup that lets the player choose the promotion piece (queen, rook, bishop, knight), then apply the move with the chosen promotion.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-expose-promotion-state-from-the-game-hook-and-wire-the-promotion-ui-to-the-existing-promotion-executor-so-the-promotion-selection-actually-completes-the-pending-move-including-for-ai-vs-player-games",
      "title": "Expose promotion state from the game hook and wire the promotion UI to the existing promotion executor so the promotion selection actually completes the pending move (including for AI-vs-player games).",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-strengthen-full-chess-rules-validation-in-the-rules-engine-so-check-checkmate-castling-safety-are-correct-including-fixing-attack-detection-so-pawn-forward-moves-are-not-treated-as-attacks",
      "title": "Strengthen full chess rules validation in the rules engine so check/checkmate/castling safety are correct, including fixing attack detection so pawn forward moves are not treated as attacks.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-update-draw-validation-to-better-reflect-standard-rules-for-threefold-repetition-tracking-and-insufficient-material-so-full-chess-rule-validation-does-not-incorrectly-declare-draws",
      "title": "Update draw validation to better reflect standard rules for threefold repetition tracking and insufficient material, so “full chess rule validation” does not incorrectly declare draws.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Implement pawn promotion from scratch with user selection via popup presented as an in-board overlay (queen/rook/bishop/knight).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Implement full chess rules validation (legal move validation including check/checkmate-related constraints).",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "projectName": "Fix pawn promotion with in-board overlay popup and strengthen full chess rules validation",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}